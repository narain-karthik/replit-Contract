{% extends "base.html" %}
{% block content %}
<h4>View Report</h4>
<form method="post" class="row g-3">
  <div class="col-md-4">
    <label class="form-label">Document Number</label>
    <input class="form-control" name="document_no" value="{{ filters.document_no }}" list="docno_list" />
    <datalist id="docno_list">
      {% for v in doc_nos %}<option value="{{ v }}"></option>{% endfor %}
    </datalist>
  </div>
  <div class="col-md-2">
    <label class="form-label">Revision Number</label>
    <input class="form-control" name="revision_no" value="{{ filters.revision_no }}" list="rev_list" />
    <datalist id="rev_list">
      {% for v in revs %}<option value="{{ v }}"></option>{% endfor %}
    </datalist>
  </div>
  <div class="col-md-3">
    <label class="form-label">Date (YYYY-MM-DD)</label>
    <input class="form-control" name="date" value="{{ filters.date }}" placeholder="2025-10-10" />
  </div>
  <div class="col-md-3">
    <label class="form-label">Material Name</label>
    <input class="form-control" name="material_name" value="{{ filters.material_name }}" />
  </div>
  <div class="col-md-12">
    <button class="btn btn-primary">Filter</button>
  </div>
</form>

<hr class="my-4" />

<h5>Document Details</h5>
<div class="table-responsive">
  <table class="table table-striped table-sm">
    <thead class="table-light">
      <tr>
        <th>ID</th>
        <th>Quantity</th>
        <th>Material Number</th>
        <th>Material Name</th>
        <th>Vendor</th>
        <th>Document No</th>
        <th>Revision No</th>
        <th>Date</th>
        <th>Status</th>
        <th>Price</th>
      </tr>
    </thead>
    <tbody>
      {% for d in docs %}
      <tr>
        <td>{{ d.id }}</td>
        <td>{{ d.quantity }}</td>
        <td>{{ d.material_number }}</td>
        <td>{{ d.material_name }}</td>
        <td>{{ d.vendor }}</td>
        <td>{{ d.document_no }}</td>
        <td>{{ d.revision_no }}</td>
        <td>{{ d.created_at }}</td>
        <td>{{ d.status }}</td>
        <td>{{ d.price }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<h5 class="mt-4">Upload Items</h5>
<div class="table-responsive">
  <table class="table table-striped table-sm">
    <thead class="table-light">
      <tr>
        <th>ID</th>
        <th>Document No</th>
        <th>Revision</th>
        <th>User ID</th>
        <th>Timestamp</th>
        <th>File</th>
      </tr>
    </thead>
    <tbody>
      {% for u in uploads %}
      <tr>
        <td>{{ u.id }}</td>
        <td>{{ u.document_no }}</td>
        <td>{{ u.revision_no }}</td>
        <td>{{ u.user_id }}</td>
        <td>{{ u.timestamp }}</td>
        <td>{{ u.filename }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<h5 class="mt-4">Download Items</h5>
<div class="table-responsive">
  <table class="table table-striped table-sm">
    <thead class="table-light">
      <tr>
        <th>ID</th>
        <th>Document No</th>
        <th>Revision</th>
        <th>User ID</th>
        <th>Timestamp</th>
        <th>File</th>
      </tr>
    </thead>
    <tbody>
      {% for d in downloads %}
      <tr>
        <td>{{ d.id }}</td>
        <td>{{ d.document_no }}</td>
        <td>{{ d.revision_no }}</td>
        <td>{{ d.user_id }}</td>
        <td>{{ d.timestamp }}</td>
        <td>{{ d.filename }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<h5 class="mt-4">Downloads by User (Summary)</h5>
<div class="table-responsive">
  <table class="table table-striped table-sm">
    <thead class="table-light">
      <tr>
        <th>Document No</th>
        <th>Revision</th>
        <th>Username</th>
        <th>Download Count</th>
      </tr>
    </thead>
    <tbody>
      {% for s in downloads_by_user %}
      <tr>
        <td>{{ s.document_no }}</td>
        <td>{{ s.revision_no }}</td>
        <td>{{ s.username if s.username else 'Unknown' }}</td>
        <td>{{ s.download_count }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}